#### 替换选项
s(substitute)命令在行中替换文本.
##### 替换标记
替换命令在替换多行的文本时能正常工作, 但默认情况下它只替换每行中出现的第一处. 替换标记能改变这种默认操作. 替换标记会在替换命令字符串之后设置
```
    s/pattern/replacement/flags
```
有4种可用的替换标记: 
1. 数字, 表明新文本将替换第几处模式匹配的地方
2. g, 表明新文本将会替换所有匹配的文本
3. p, 表明原先行的内容要打印出来
4. w file, 将替换的结果写到文件中

##### 替换字符
sed编辑器允许选择其他字符作为替换命令中的字符串分隔符. 如
```
    sed 's!/bin/bash!/bin/csh!' /etc/passwd
```
在这个例子中, 感叹号被用作字符串分隔符.

#### 使用地址
sed编辑器使用的命令会作用于数据文本的所有行. 只想命令作用于特定行或某些行, 必须用行寻址(line addressing). sed编辑器中有两种形式的行寻址: 
1. 以数字形式表示行区间
2. 用文本模式来过滤出行

##### 数字方式的行寻址
当使用数字方式的行寻址时, 可以用行在文本流中的行位置来引用. sed编辑器会将文本流中的第一行编号为1. 在命令中指定的地址可以是单个行号, 或是用起始行号、逗号以及结尾行号指定的一定区间范围内的行.

##### 使用文本模式过滤器
sed编辑器允许指定文本模式来过滤出命令要作用的行. 格式如下:
```
    /pattern/command
```
用正斜线将指定的pattern封起来. sed编辑器会将命令作用到包含指定文本模式的行上. pattern中可以使用正则表达式.

##### 命令组合
如果需要在单行上执行多条命令, 可以用花括号将多条命令组合在一起. 

##### 删除行
删除命令d, 它会删除匹配指定寻址模式的所有行. 当和指定地址一起使用时, 删除命令就能发挥出最大的功用. 通过行号指定, 删除特定的文本行. 
```
    sed '2, 3d' data
```
也可以使用两个文本模式来删除某个区间的行. 指定的第一个模式会"打开"行删除功能, 第二个模式会"关闭"行删除功能. sed编辑器会删除两个指定行之间的所有行(包括指定的行)

##### 插入和附加文本
sed编辑器允许向数据流中插入和附加文本行. 两个操作的区别在于: 
1. 插入(insert)命令(i)会在指定行前增加一个新行
2. 附加(append)命令(a)会在指定行后增加一个新行
格式如下: 
```
    sed '[address] command\
    new line'
```
##### 修改行
修改(change)命令c允许修改数据流中整行文本的内容. 它跟插入和附加命令的工作机制一样, 必须在sed命令中单独指定新行.
```
    sed '3c\
    > This is a new line ' data
```

##### 转换命令
转换(transform)命令(y)是唯一可以处理单个字符的sed编辑器命令. 转换命令格式如下:
```
    [address]y/inchars/outchars/
```
转换命令会对inchars和outchars值进行一对一的映射. 如果inchars和outchars的长度不同, 则sed编辑器会产生一条错误消息.

##### 打印

###### 打印行
跟替换命令中的p标记类似, p命令可以打印sed编辑器输出中的一行. 打印命令最常见的用法就是打印包含匹配文本模式的行.

###### 打印行号
等号命令会打印行在数据流中的当前行号. 行号由数据流中的换行符决定. 

###### 列出行
列出(list)命令l可以打印数据流中的文本和不可打印的ASCII字符. 

##### 使用sed处理文件

###### 写入文件
w命令用来向文件写入行. 命令格式如下:
```
    [address] w filename
```
filename可以使用相对路径或绝对路径, 地址可以是sed中支持的任意类型的寻址方式. 

###### 从文件读取数据
读取(read)命令(r)允许将一个独立文件中的数据插入到数据流中. 读取命令的格式如下:
```
    [address] r filename
```
filename参数指定了数据文件的绝对路径或相对路径. 在读取命令中使用地址区间, 只能指定单独一个行号或文本模式地址. sed编辑器会将文件中的文本插入到指定地址后.
```
    sed '3r data2' data
```
#### 多行命令
sed编辑器包含了三个可用来处理多行文本的特殊命令
1. N: 将数据流中的下一行加进来创建一个多行组(multiline group)来处理
2. D: 删除多行组中的一行
3. P: 打印多行组中的一行

##### next命令

###### 单行next命令
小写的n命令会告诉sed编辑器移动到数据流中的下一文本行, 而不用重新回到命令的最开始再执行一遍

###### 合并文本行
多行版本的next命令(大写N)会将下一文本行添加到模式空间中已有的文本后. 这样的作用是将数据流中的两个文本行合并到同一个模式空间中. 文本行仍然用换行符分隔, 但sed编辑器会将两行文本当作一行来处理.

###### 多行删除命令
sed编辑器提供的多行删除命令D, 它只删除模式空间中的第一行. 该命令会删除到换行符(含换行符)为止的所有字符.

###### 多行打印命令
多行打印命令(P)沿用了同样的方法, 它只打印多行模式空间中的第一行. 多行P命令的强大之处在于和N命令及D命令组合使用时才能显现出来. D命令的独特之处在于强制sed编辑器返回到脚本的起始处, 对同一模式空间中的内容重新执行这些命令.

##### 保持空间
模式空间(pattern space)是一块活跃的缓冲区. 在sed编辑器执行命令时它会保存待检查的文本. 但还有其他活动的缓冲区.  
sed编辑器有另一块称作保持空间(hold space)的缓冲区域. 在处理模式空间中的某些行时, 可以用保持空间来临时保存一些行. 
1. h: 将模式空间复制到保持空间
2. H: 将模式空间附加到保持空间
3. g: 将保持空间复制到模式空间
4. G: 将保持空间附加到模式空间
5. x: 交换模式空间和保持空间的内容

##### 排除命令
感叹号命令(!)用来排除(negate)命令, 也就是让原来会起作用的命令不起作用.

#### 改变流
sed编辑器提供了一个方法来改变命令来改变脚本的执行流程.

##### 分支
sed编辑器提供了一种方法, 可以基于地址、地址模式或地址区间排除一整块命令. 只对数据流中的特定行执行一组命令. 分支(branch)命令b的格式如下:
```
    [address] b [label]
```
address参数决定了哪些行的数据会触发分支命令. label参数定义了要跳转到的位置. 如果没有加label参数, 跳转命令会跳转到脚本的结尾. 要是不想直接调到脚本的结尾, 可以为分之命令定义一个要跳转到的标签. 标签以冒号开始, 最多可以是7个字符长度. 要指定标签, 将它加到b命令后即可.

##### 测试
测试(test)命令(t)可以用来改变sed编辑器脚本的执行流程. 测试命令会根据替换命令的结果跳转到某个标签, 而不是根据地址进行跳转. 如果替换命令成功匹配并替换了一个模式, 测试命令就会跳转到指定的标签. 如果替换命令未能匹配指定的模式, 测试命令就不会跳转.  
测试命令使用与分支命令相同的格式
```
    [address] t [label]
```
在没有指定标签的情况下, 如果测试成功, sed会跳转到脚本的结尾. 

#### 模式替代

##### &符号
sed编辑器提供了&符号可以用来代表替换命令中的匹配的模式.不管模式匹配的什么样的文本, 都可以在替代模式中使用&符号来使用这段文本.

##### 替换单独的单词
sed编辑器用圆括号来定义替换模式中的子模式. 可以在替换模式中使用特殊字符来引用每个子模式. 替代字符由反斜线和数字组成. 数字表明子模式的位置. 
> 在替换命令中使用圆括号时, 必须用转义字符将它们标示为分组字符而不是普通的圆括号.
示例
```
  $ echo 'The system Administrator manual' | sed '
  > s/\(system\) Administrator/\1 User/'
  $ The system User manual
```

#### 在脚本中使用sed

##### 使用包装脚本
当脚本很长的话, 可以将sed编辑器命令放到shell包装脚本中, 不用每次都重新输入整个脚本.
```
# shell wrapper for sed editor script to reverse text file lines
sed -n '{1!G ; h ; $p }' $1
```
##### 重定向sed的输出

#### sed实用工具

##### 加倍行间距
```
$ sed '$!G' data
```