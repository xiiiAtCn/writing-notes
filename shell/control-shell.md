#### 处理信号

##### 生成信号
bash shell允许使用键盘上的组合键生成两种基本的Linux信号.  
1. 中断进程  
Ctrl + C组合键会生成SIGINT信号, 停止shell中当前运行的进程.
2. 暂停进程  
Ctrl+Z组合键会生成一个SIGTSTP信号, 停止shell中运行的任何进程. 

##### 捕获信号
trap 命令可以指定shell脚本要监看并从shell中拦截的Linux信号. 如果脚本收到了trap命令中列出的信号, 该信号不再由shell处理, 而是交由本地处理.
```
trap commands signals
```
##### 捕获脚本并退出
除了在shell脚本中捕获信号, 也可以在shell脚本退出时进行捕获. 这是在shell完成任务时执行命令的一种简便方法. 要捕获shell脚本的退出, 只要在trap命令后面加上EXIT信号就行.

##### 修改或移出捕获
要想在脚本中的不同位置进行不同的捕获, 只需重新使用带有新选项的trap命令. 修改了信号捕获之后, 脚本处理信号的方式就会发生变化. 但如果一个信号是在捕获前收到的, 那么脚本脚本仍然会根据最初的trap命令进行处理. 也可以删除已设置好的捕获. 只需要在trap命令与希望恢复默认行为的信号列表之间加上两个破折号. 也可以使用单破折号.

#### 以后台模式运行脚本
以后台模式运行shell脚本, 只要在命令后加个$符就可以. 将命令作为系统中的一个独立的后台进程. 但后台进程运行时, 仍然会使用终端显示器来显示STDOUT和STDERR消息.

##### 运行多个后台作业
可以在命令行提示符下同时启动多个后台作业. 在ps命令的输出中, 每一个后台进程都和终端会话联系在一起, 如果终端退出, 那么后台进程也会随之退出.

#### 在非控制台下运行脚本
nohup命令运行了另外一个命令来阻断所有发送给该进程的SIGHUP信号. 命令格式如下:
```
    nohup ./test &
```

#### 作业控制
启动、停止、终止以及恢复作业的这些功能统称为作业控制.

##### 查看作业
jobs命令允许查看shell当前正在处理的作业. jobs常用的命令行参数.

|参数|描述|
|---|---|
|-l|列出进程的PID以及作业号|
|-n|只列出上次shell发出的通知后改变了状态的作业|
|-p|只列出作业的PID|
|-r|只列出运行中的作业|
|-s|只列出已停止的作业|
jobs命令输出中带有加号和减号. 带加号的作业被当作默认作业. 在使用作业控制命令时, 如果未在命令行指定任何作业号, 该作业会被当成作业控制命令的操作对象. 当前的默认作业完成处理后, 带减号的作业成为下一个默认作业.

##### 重启停止的作业
可以将已停止的作业作为后台进程或前台进程重启. 前台进程会接管当前工作的终端. 要以后台模式重启一个作业, 可以用bg命令加上作业号.

#### 调整谦让度
调度优先级是个整数值, 从-20到19, 优先级从高到低. 默认情况下, bash以优先级0来启动所有进程. 改变进程的优先级, 可以使用nice命令.

##### nice命令
nice命令会让脚本以更低的优先级运行, 但如果想要调高优先级, 则必须使用root用户.

##### renice命令
renice允许指定运行进程的PID来改变它的优先级. renice命令也有限制:
1. 只能对属于自己的进程执行renice
2. 只能通过renice降低进程的优先级
3. root用户可以通过renice来任意调整进程的优先级

#### 定时运行作业
Linux系统提供了多个在预选时间运行脚本的方法: at命令和cron表. 每个方法都使用不同的技术来安排脚本的运行时间和频率.

##### 用at命令来计划执行作业
at命令允许指定Linux系统何时运行脚本. at的守护进程atd会以后台模式运行, 检查作业队列来运行作业. atd守护进程会检查系统上的一个特殊目录(通常位于/var/spool/at)来获取用at命令提交的作业. 默认情况下, atd守护进程会每60秒检查一下这个目录. 
1. at命令的格式  
```
    at [-f filename] time
```
time参数指定了Linux系统何时运行该作业. 如果指定的时间错误, at命令会在第二天的那个时间运行指定的作业.  
时间的指定非常灵活, at命令能够识别多种不同的时间格式:
* 标准的小时和分钟格式, 如10:45
* AM/PM指示符, 如10:15AM
* 特定可命令时间, 如now、noon、midnight或者teatime(4 PM)  
除了指定时间外, 还可以通过不同的日期格式来指定特定的日期
* 标准日期格式, 比如MMDDYY, MM/DD/YY或DD.MM.YY
* 文本日期 如 Jul 4, 加不加年份均可
* 也可以指定时间增量. 当天时间+25min

2. 获取作业的输出. Linux系统会将提交该作业的用户的电子邮件地址作为STDOUT和STDERR. at命令利用sendemail应用程序来发送邮件.
3. 列出等待的作业. atq命令可以查看系统中有哪些作业在等待
4. 删除作业. 一旦知道哪些作业在作业队列中等待, 就能用atrm命令来删除等待中的作业.

##### 安排需要定期执行的作业
Linux系统使用cron程序来安排要定期执行的作业. cron程序会在后台运行并检查一个特殊的表, 称作cron时间表, 以获知已安排执行的作业.
1. cron时间表  
cron时间表采用一种特别的格式来指定作业何时运行. 其格式如下: 
```
    min hour dayofmonth month dayofweek command
```
可以用三字符的文本值(mon tue wed thu fri sat sun)或数值(0为周日, 6为周六)来指定dayofweek值.  
命令列表必须指定要运行的命令或脚本的全路径名. cron程序会用提交作业的用户账户运行该脚本.  
2. 构建cron时间表  
crontab命令被用来处理cron时间表.
```
crontab -l
```
3. 浏览cron目录  
如果创建的脚本对精确的执行时间要求不高, 用预配置的cron脚本会更方便. 有4个基本目录: hourly、daily、monthly和weekly, 它们存放在/etc/cron.*下

##### anacron程序
如果anacron知道某个作业错过了执行时间, 它会尽快运行该作业. 这个功能常用于进行常规日志维护的脚本. aracron程序只会处理位于cron目录的程序. 它用时间戳来决定作业是否在正确的计划间隔内运行了. 每个cron目录都有个时间戳文件, 该文件位于/var/spool/anacron. anacron程序使用自己的时间表(通常位于/etc/anacrontab)来检查作业目录. anacron时间表如下:
```
    period delay identifier command
```
period条目定义了作业多久运行一次, 以天为单位. anacron程序用此条目来检查作业的时间戳文件. delay条目会指定系统启动后anacron程序需要等待多少分钟再开始运行错过的脚本. command条目包含了run-parts程序和一个cron脚本目录名. run-parts程序负责运行目录中传给它的任何脚本.  
anacron不会运行位于/etc/cron.hourly的脚本. 因为anacro程序不会处理执行时间需求少于1天的脚本. identifie条目是一种特殊的非空字符串. 如cron-weekly. 它用于唯一标识日志消息和错误邮件中的作业.

##### 使用新shell启动脚本















































